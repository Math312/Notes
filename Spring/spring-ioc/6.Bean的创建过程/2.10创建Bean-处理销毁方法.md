# 创建Bean-处理销毁方法

之前已经讨论了Bean创建的绝大多数逻辑，但是Bean终有销毁的时候，那么bean的销毁方法到底是怎么执行？什么时候执行的呢？本节主要讨论该问题。

在创建Bean的最后一步，有如下代码：

```java
registerDisposableBeanIfNecessary(beanName, bean, mbd);
```

改行代码用于将Bean与Bean的销毁方法联系起来，方便在需要销毁时调用。考虑`registerDisposableBeanIfNecessary(String beanName, Object bean, RootBeanDefinition mbd)`方法，该方法传入了三个参数：

1. beanName: 创建的bean名称
2. bean:创建的bean
3. mbd:创建的Bean的BeanDefinition

代码逻辑也相对简单：

```java
protected void registerDisposableBeanIfNecessary(String beanName, Object bean, RootBeanDefinition mbd) {
    AccessControlContext acc = (System.getSecurityManager() != null ? getAccessControlContext() : null);
    if (!mbd.isPrototype() && requiresDestruction(bean, mbd)) {
        if (mbd.isSingleton()) {
            registerDisposableBean(beanName,
                new DisposableBeanAdapter(bean, beanName, mbd, getBeanPostProcessors(), acc));
        }
        else {
            Scope scope = this.scopes.get(mbd.getScope());
            if (scope == null) {
                throw new IllegalStateException("No Scope registered for scope name '" + mbd.getScope() + "'");
            }
            scope.registerDestructionCallback(beanName,
                new DisposableBeanAdapter(bean, beanName, mbd, getBeanPostProcessors(), acc));
        }
    }
}
```
