# BeanFactoryPostProcessor

该接口是BeanFactory的后处理器，该接口用于在beanFactory完成初始化操作后进行一系列的后处理操作。例如，更改bean factory中的bean定义，调整bean定义中的属性等等。

Spring允许用户自定义配置文件去覆盖Context中配置的Bean属性。这部分逻辑就是通过BeanFactoryPostProcessor的子类`PropertyResourceConfigurer`实现的。

需要注意的是`BeanFactoryPostProcessor`更改的只是bean定义，不能更改bean实例，如果需要更改bean实例，请使用`BeanPostProcessor`。

`AbstractApplicationContext`中的`beanFactoryPostProcessors`属性用于保存注册了的`BeanFactoryPostProcessor`，可以通过`ConfigurableApplicationContext`提供的`void addBeanFactoryPostProcessor(BeanFactoryPostProcessor postProcessor);`方法其进行管理。

需要注意，一般实现了`BeanFactoryPostProcessor`接口的类都实现了`Ordered`接口或者其子接口`PriorityOrdered`，Spring根据该接口决定`BeanFactoryPostProcessor`的处理顺序。处理顺序是，先处理实现了`PriorityOrdered`接口的对象，在执行实现了`Ordered`接口的对象，最后处理未实现`Ordered`接口的对象。

注意，处理实现了`Ordered`接口及其子接口的`BeanFactoryPostProcessor`时，根据`Ordered`接口和`PriorityOrdered`进行排序。然后按序处理。不过此时仍有例外，只有作为bean注册到beanFactory的`BeanFactoryPostProcessor`才符合上述处理规则，如果是直接写死在`beanFactoryPostProcessors`属性中的对象，则按序进行处理，不符合上述处理规则。

该接口要求实现如下方法：

```java
void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;
```

该方法传入了beanFactory，用户可以对其进行更改。此时，所有基本的Bean定义均已注册到BeanFactory中，但是还尚未实例化。但是根据接口提供的方法可以看到，不仅仅可以修改Bean定义，还可以修改beanFactory配置。

为了使得接口功能更加专一，创建了`BeanFactoryPostProcessor`接口的子接口`BeanDefinitionRegistryPostProcessor`，该接口仅仅要求实现了如下方法：

```java
void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException;
```

可以看到该方法的入参是`BeanDefinitionRegistry`而不是`ConfigurableListableBeanFactory`，`BeanDefinitionRegistry`仅仅提供了修改bean定义的方法，不像`ConfigurableListableBeanFactory`提供了beanFactory的管理接口，所以仅仅提供了管理Bean定义的方法。
