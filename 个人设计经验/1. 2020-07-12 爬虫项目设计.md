# 2020-07-12 爬虫项目设计

该项目输入为抖音、快手的分享链接，将链接中的无水印视频、封面、标题全部提取，然后将数据上传到COS中。

设计思路：

1. 该项目实际上分为三部分：
   1. 获取视频链接HTML页面
   2. 解析HTML页面得到无水印链接
   3. 无水印视频的上传

可变部分：

1. 获取视频链接HTML页面平台不同：
   1. URL直接请求
   2. 手动上传
2. HTML页面格式逻辑变动
3. 无水印视频上传平台改变，上传逻辑出现更改

项目难题：

1. 如何通过HTML页面获取到无水印链接
    通过查阅资料发现，快手平台在手机端访问分享链接时，存在一个`id`为`hide-pagedata`的标签，该标签中存储了无水印视频链接。抖音平台在手机端访问分享链接时，将带水印链接中的`playwm`换为`play`即可得到无水印视频链接

隐藏难题：

1. 如何获取js渲染完毕的HTML页面
    1. 通过较新版本的htmlUnit，不过对于Linux的兼容性可能不是很好
    2. 通过Chrome+seleunim，相对较重量级，但是比较稳定，因为是调用Chrome，所以chrome访问正常的都可以。

一般情况下处理上述问题思路应该如下：

```java
|      抓取器     |       |      解析器            |       |       上传器                   |      |    第三方平台统一接口    |
| 通过链接获取HTML |       |  通过HTML解析到规定数据  |       |   通过URL获取到数据上传到第三方平台|      |    上传数据            |
```

我的设计：

```java
|      抓取解析器       |              |       上传器                   |
| 通过链接获取HTML并解析 |              |   通过URL获取到数据上传到第三方平台|
```

由于当前境况使用到的是COS，因此第三方平台上传暂时不提供统一接口，单独上传即可，需要扩展时，单独扩展接口，覆盖doUpload()方法即可。

本设计最大缺陷是抓取和解析操作放在一起，导致解析操作不能复用。